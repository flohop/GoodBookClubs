{% extends "base.html" %}
{% load static %}

{% block title %}{{ club.group_name }}{% endblock %}

{% block content %}
    <!-- Block the form request from being send again, when page is reloaded !-->
     <script>
            if (window.history.replaceState) {
                window.history.replaceState( null, null, window.location.href );
                }
        </script>

<!-- heading -->
    <p class="top-title">{{ club.group_name }}{% if club.is_admin %}
        <span class="admin-edit"><a href="{% url 'club:edit_discussion' id=club.id %}">Edit</a></span>
        {% endif %}</p>

<!-- image -->
    {% load thumbnail %}
    {% thumbnail club.group_image "300" as im %}
        <img src="{{ im.url }}" class="club-image"/>
    {% endthumbnail %}

<!--text next to image -->
    <ul class="club-details">
        <li class="club description">{{ club.group_description }}</li>
        {% if club.current_book %}
            <li class="club current-book"><a href="{{ club.current_book.get_absolute_url }}">{{ club.current_book.book_title }}</a></li>
        {% else %}
            <li class="club no-current-book">No current book</li>
        {% endif %}
    </ul>

<!-- show all the members -->
    <span class="all-member">
        <p class="members-header">Members</p>
        <ul class="members">
            {% for member in all_members %}
            <li class="member">
                <span>{{ member }}</span>
            </li>
            {% endfor %}
        </ul>
    </span>

<!-- join group -->

    <div class="member-count">
        <span class="count-members">{{ club.member_count }}</span> Member{{ club.member_count|pluralize }}
        <a href="#" data-id="{{ club.id }}" data-group_type="discussion" data-action="{% if club.is_member %}leave{% else %}join{% endif %}"
            class="join-toggle button">{% if club.is_member %}Leave{% else %}Join{% endif %}</a>
    </div>



    <div class="card-body">
        {% if  new_comment %}

        {% else %}
            <h4>Add comment</h4>
            <form method="post">
                {{ comment_form.as_p }}
                {% csrf_token %}
                <button type="submit" class="btn">Submit</button>
            </form>
        {% endif %}
        </div>


    <h4>Comments:</h4>
    {% for comment in comments %}
        <div class="comments" style="padding: 10px;">
            <p>{{ comment.name }}</p>
            <p>{{ comment.created_on }}</p>
            <p>{{ comment.body }}</p>

        </div>
    {% endfor %}

<!-- Load needed JavaScript variable-->
<script>var toggle_view_url = "{% url 'club:toggle' %}"</script>
<script>var like_toggle_url = "{% url 'book:like' %}"</script>

{% endblock %}

{%  block javascript %}
<script src="{% static 'club/toggle_member.js' %}"></script>
{% endblock %}
